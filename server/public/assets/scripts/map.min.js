/*! csa 2016-01-11 */
function displayLoading(){$("#spin").addClass("spinner"),$("body").addClass("backgroundSpin")}function displayCompleted(){$("#spin").removeClass("spinner"),$("body").removeClass("backgroundSpin")}var myLatLng={},storesFound=[],storeContent=[];$(document).ready(function(){displayLoading(),$("body").css("overflow","hidden");var a=1;$("#popupButton").click(function(){1==a?($("#navMenu").stop(!0,!1).animate({bottom:200},600),a=0):($("#navMenu").stop(!0,!1).animate({bottom:100},600),a=1)}),getCurrentLocation(),$("body").on("click",".action",function(){localStorage.clear(),console.log("working"),console.log($(this).data("list"));var a=Number($(this).data("list"));console.log(storesFound[a]),localStorage.setItem("kittyFoo",JSON.stringify(storesFound[a])),window.location.href="store.html"})});var findStore=function(){console.log("The location data being sent to the db as search criteria: ",myLatLng),$.ajax({type:"GET",url:"/addStore",data:myLatLng,success:function(a){return console.log("The data response from the db: ",a),storesFound=a,console.log("The storesFound: ",storesFound),displayCompleted(),initMap(myLatLng,storesFound),storesFound}})},getCurrentLocation=function(){function a(a,b,c){b.setPosition(c),b.setContent(a?"Error: The Geolocation service failed.":"Error: Your browser doesn't support geolocation.")}myLatLng={},navigator.geolocation?navigator.geolocation.getCurrentPosition(function(a){myLatLng.lat=parseFloat(a.coords.latitude),myLatLng.lng=parseFloat(a.coords.longitude),console.log("The variable LatLng: ",myLatLng),findStore()}):a(!1,infoWindow,map.getCenter())},initMap=function(a,b){storeContent=[];var c=new google.maps.InfoWindow,d=new google.maps.Map(document.getElementById("mapContainer"),{zoom:12,center:a,streetViewControl:!0,streetViewControlOptions:{position:google.maps.ControlPosition.RIGHT_TOP},zoomControl:!0,zoomControlOptions:{position:google.maps.ControlPosition.RIGHT_TOP}}),e=new google.maps.LatLngBounds,f=new google.maps.Marker({position:a,map:d,title:"You Are Here"});f.addListener("click",function(){console.log("center")});for(var g=0;g<b.length;g++){var h=new google.maps.Marker({position:new google.maps.LatLng(b[g].latlong[0],b[g].latlong[1]),map:d,title:b[g].name,icon:"http://maps.google.com/mapfiles/ms/micons/purple-dot.png"}),i=setContentstring(b[g],g);storeContent.push(i),google.maps.event.addListener(h,"click",function(a,b){return console.log("click!"),function(){c.setContent(storeContent[b]),c.open(d,a)}}(h,g)),e.extend(h.position)}e.extend(f.position),d.fitBounds(e)},setContentstring=function(a,b){var c=(3963.2*a.distance).toFixed(1),d="https://www.google.com/maps/dir/Current+Location/",e=a.latlong[0],f=a.latlong[1],g=d+e+","+f;return console.log("here is store ",a),contentString='<div class="container"><div class="col-xs-12"><h4 class = "action" data-list=" '+b+' "> '+a.name+'</h4><img src="http://www.fillmurray.com/300/200" alt="store logo"/></div><div class="col-xs-12"><h5>'+a.description+"</h5></br><h6>"+c+' Miles</h6><button><a href=" '+g+' ">Directions</a></button></div></div>',contentString};